# Requirements Archive: v1.1 Spanish Autónomo Tax Calculator

**Archived:** 2026-02-03
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.1.
For current requirements, see `.planning/REQUIREMENTS.md` (will be created for next milestone).

---

**Defined:** 2026-01-29
**Core Value:** Accurate, real-time calculation of net monthly income after all taxes (RETA + IRPF), with Belgium work cost tracking and 183-day residency management

## v1 Requirements - All 68 Satisfied ✓

Requirements for initial release. Each maps to roadmap phases.

### Tax Calculations (CALC) - 10/10 ✓

- [x] **CALC-01**: Calculate annual IRPF using official 2025/2026 progressive brackets (19%, 24%, 30%, 37%, 45%, 47%) — v1.1
- [x] **CALC-02**: Apply minimo personal (5,550 EUR) in IRPF calculation — v1.1
- [x] **CALC-03**: Apply minimo por descendientes (2,400 EUR for 1 daughter) in IRPF calculation — v1.1
- [x] **CALC-04**: Calculate 5% gastos de dificil justificacion with 2,000 EUR annual cap — v1.1
- [x] **CALC-05**: Apply 7% reduccion rendimientos for generic SS expenses — v1.1
- [x] **CALC-06**: Use fixed RETA cuota of 428.40 EUR/month (5,140.80 EUR/year) from registration — v1.1
- [x] **CALC-07**: Calculate effective tax rate (total tax / net income before tax) — v1.1
- [x] **CALC-08**: Calculate net monthly income after all taxes and deductions — v1.1
- [x] **CALC-09**: Calculate "leefgeld" (net income minus 1,727 EUR private costs) — v1.1 (renamed to "Disposable Income")
- [x] **CALC-10**: Show annual and monthly breakdowns for all calculations — v1.1

### Expense Tracking (EXP) - 5/5 ✓

- [x] **EXP-01**: Track Spain deductible business expenses (huur 346.50 EUR, GSM 27.50 EUR, elektriciteit 9.00 EUR/month) — v1.1
- [x] **EXP-02**: Track Belgium work costs (1,000 EUR or 2,500 EUR/month depending on pattern) — v1.1 (generalized to Work Travel)
- [x] **EXP-03**: Track non-deductible private expenses (1,727 EUR/month total) — v1.1
- [x] **EXP-04**: Categorize expenses as deductible vs private in UI — v1.1
- [x] **EXP-05**: Display expense breakdown with calculation formulas visible (e.g., "1,155 EUR x 30%") — v1.1

### Scenario Planning (SCEN) - 7/7 ✓

- [x] **SCEN-01**: Pre-configure 5 scenarios (A: 3K, B: 6K, C: 9K, D: 12K, E: 18K revenue) — v1.1
- [x] **SCEN-02**: Support two Belgium cost patterns (1,000 EUR for A/B, 2,500 EUR for C/D/E) — v1.1
- [x] **SCEN-03**: Allow creation of custom scenarios with user-defined revenue/expenses — v1.1
- [x] **SCEN-04**: Allow live editing of any value in any scenario with auto-recalculation — v1.1
- [x] **SCEN-05**: Display all scenarios side-by-side in comparison table — v1.1
- [x] **SCEN-06**: Highlight/compare selected scenarios (dim others) — v1.1
- [x] **SCEN-07**: Show which scenario is "optimal" based on leefgeld after costs — v1.1

### Belgium Calendar (CAL) - 9/9 ✓

- [x] **CAL-01**: Display interactive calendar for Feb-Dec 2026 (11 months) — v1.1
- [x] **CAL-02**: Allow toggling individual days between Belgium, Spain, Travel — v1.1
- [x] **CAL-03**: Auto-count days per month in each location — v1.1
- [x] **CAL-04**: Calculate annual total days in Belgium vs Spain — v1.1
- [x] **CAL-05**: Show 183-day threshold warning when approaching or exceeding limit — v1.1
- [x] **CAL-06**: Pre-fill calendar with contracted pattern (Mon-Tue always, first week Wed-Fri) — v1.1
- [x] **CAL-07**: Visually distinguish contractual obligation days from flexible days — v1.1
- [x] **CAL-08**: Export calendar data (ICS, CSV, or copy to clipboard) — v1.1
- [x] **CAL-09**: Count entry/exit days correctly (warning that they count in BOTH countries) — v1.1

### Dashboard UI (UI) - 12/12 ✓

- [x] **UI-01**: Professional financial dashboard aesthetic (Bloomberg-inspired, not generic AI) — v1.1
- [x] **UI-02**: Scenario cards with key metrics (revenue, expenses, taxes, net income) — v1.1
- [x] **UI-03**: Hover effects on scenario cards with subtle lift and border glow — v1.1
- [x] **UI-04**: Click to expand scenario cards for detailed breakdown — v1.1
- [x] **UI-05**: Comparison table with all metrics across scenarios — v1.1
- [x] **UI-06**: Sticky first column in comparison table for scrolling — v1.1
- [x] **UI-07**: Color-coding for positive (green), negative (red), warning (orange) values — v1.1
- [x] **UI-08**: Responsive design (desktop primary, mobile functional) — v1.1
- [x] **UI-09**: Tooltips on technical terms (hover for explanation) — v1.1
- [x] **UI-10**: Export functionality (print view, copy to clipboard) — v1.1
- [x] **UI-11**: Professional typography (DM Sans or similar, JetBrains Mono for numbers) — v1.1
- [x] **UI-12**: Dark theme with rich colors (not purple gradients on white) — v1.1

### Excel Calculator (XLS) - 10/10 ✓

- [x] **XLS-01**: Create multi-sheet workbook (Overview + 5 scenario sheets) — v1.1
- [x] **XLS-02**: Overview sheet with all scenarios comparison table — v1.1
- [x] **XLS-03**: Individual sheets per scenario (A, B, C, D, E) with detailed breakdowns — v1.1
- [x] **XLS-04**: All calculations use Excel formulas (NO hardcoded calculated values) — v1.1
- [x] **XLS-05**: Professional styling with color-coded headers and borders — v1.1
- [x] **XLS-06**: Include expense breakdown tables on each sheet — v1.1
- [x] **XLS-07**: Include RETA and IRPF step-by-step calculations — v1.1
- [x] **XLS-08**: Workbook recalculates without errors (#REF!, #DIV/0!, #VALUE!, #NAME?) — v1.1
- [x] **XLS-09**: Currency formatting (EUR #,##0.00 for decimals, EUR #,##0 for whole numbers) — v1.1
- [x] **XLS-10**: Percentage formatting (0.0%) for tax rates — v1.1

### Compliance & Warnings (COMP) - 10/10 ✓

- [x] **COMP-01**: Display 183-day threshold warning when days in Belgium >= 183 — v1.1
- [x] **COMP-02**: Show Spain-Belgium treaty tie-breaker provisions (Article 4) — v1.1
- [x] **COMP-03**: Explain "centro de intereses vitales" concept and how family situation helps — v1.1
- [x] **COMP-04**: Display Art. 9.1.b LIRPF family presumption text and implications — v1.1
- [x] **COMP-05**: List documentation requirements for expense deductibility — v1.1
- [x] **COMP-06**: Warning about factura completa requirement (not just tickets) — v1.1
- [x] **COMP-07**: Warning about electronic payment requirement (no cash for dietas) — v1.1
- [x] **COMP-08**: Disclaimer that tool provides calculations, not official tax advice — v1.1
- [x] **COMP-09**: Show dietas limits (91.35 EUR/day with overnight, 48.08 EUR without) — v1.1
- [x] **COMP-10**: Warning about entry/exit days counting in BOTH countries — v1.1

### Data Verification (DATA) - 5/5 ✓

- [x] **DATA-01**: All fiscal data sourced from official 2025/2026 AEAT/BOE/Seguridad Social sources — v1.1
- [x] **DATA-02**: Source citations visible in UI (footnotes or info boxes) — v1.1
- [x] **DATA-03**: IRPF tramos match official 2025 brackets exactly — v1.1
- [x] **DATA-04**: Minimos match official 2025/2026 amounts — v1.1
- [x] **DATA-05**: Dietas match official Reglamento IRPF rates — v1.1

## v1.1 Requirements - All 11 Satisfied ✓

Critical bug fixes and enhancements discovered during user testing.

### Critical Bug Fixes (BUG) - 5/5 ✓

- [x] **BUG-01**: Fix add expense button - currently doesn't open form or create expenses — v1.1
- [x] **BUG-02**: Fix tooltip positioning - open as centered modal with background blur instead of top-aligned — v1.1
- [x] **BUG-03**: Remove all Dutch text - everything must be in English — v1.1
- [x] **BUG-04**: Redesign Belgium cost toggle - use pill-style buttons instead of circular dots — v1.1
- [x] **BUG-05**: Enhance calendar multi-select - add week selection and month selection — v1.1

### Enhanced Features (ENH) - 6/6 ✓

- [x] **ENH-01**: Auto-detect 100% deductible expenses when user adds them — v1.1
- [x] **ENH-02**: Add income tracking tab with client earnings, invoice numbers, and auto-calculation — v1.1
- [x] **ENH-03**: Add official Spanish Agencia Tributaria source links to Details tab — v1.1
- [x] **ENH-04**: Add official Spanish Agencia Tributaria source links to Compliance tab — v1.1
- [x] **ENH-05**: Make all source citations clickable with URLs — v1.1
- [x] **ENH-06**: Add visual feedback for multi-select calendar ranges — v1.1

## v2 Requirements

Deferred to future milestone. Tracked but not in v1.1 scope.

### Advanced Features

- **ADV-01**: Quarterly Modelo 130 calculation and payment tracking
- **ADV-02**: RETA regularization estimator (compare actual vs declared tramo)
- **ADV-03**: Monthly bank transaction import for expense tracking
- **ADV-04**: A1 certificate expiration tracking
- **ADV-05**: VeriFactu compliance checker (July 2026 requirement)
- **ADV-06**: Belgian IVA recovery (Modelo 360) tracker
- **ADV-07**: Historical data tracking (compare 2026 vs 2027)
- **ADV-08**: Multi-year projection (plan 2027-2028)
- **ADV-09**: PDF export of full tax analysis report
- **ADV-10**: Integration with gestor systems (API)

### Enhanced Calendar

- **CAL-11**: Calendar sync with Google Calendar / iCal
- **CAL-12**: Automatic travel expense calculation based on calendar days
- **CAL-13**: Dietas calculation per day based on overnight status
- **CAL-14**: Multi-year calendar (2026-2027)
- **CAL-15**: Calendar templates for different work patterns

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Multi-country support | Spain-Belgium specific, not building general EU calculator |
| Automatic bank integration | Security/privacy concerns, manual input sufficient for v1 |
| IVA/VAT tracking | Focus on income tax (IRPF/RETA), not VAT compliance |
| Mobile native apps | Web-based responsive design sufficient |
| Multi-user accounts | Single-user tool for personal use |
| Gestor API integration | Standalone tool, not integrated with third-party systems |
| Real-time AEAT API | Official APIs not available for autonomos |
| AI-powered optimization | Rule-based calculations sufficient, no ML needed |
| Cryptocurrency income | Standard employment/consulting income only |

## Traceability

All requirements traced to phases and verified in milestone audit.

| Requirement | Phase | Status |
|-------------|-------|--------|
| CALC-01 through CALC-10 | Phase 1 | Complete ✓ |
| EXP-01 through EXP-05 | Phase 2 | Complete ✓ |
| SCEN-01 through SCEN-07 | Phase 3 | Complete ✓ |
| CAL-01 through CAL-09 | Phase 4 | Complete ✓ |
| UI-01 through UI-12 | Phase 5 | Complete ✓ |
| XLS-01 through XLS-10 | Phase 6 | Complete ✓ |
| COMP-01 through COMP-10 | Phase 7 | Complete ✓ |
| DATA-01 through DATA-05 | Phase 1, 2 | Complete ✓ |
| BUG-01 through BUG-05 | Phase 7.1 | Complete ✓ |
| ENH-01 through ENH-06 | Phase 8 | Complete ✓ |

**Coverage:**
- v1 requirements: 68 total (100% complete)
- v1.1 requirements: 11 total (100% complete)
- Total: 79 requirements
- Mapped to phases: 79/79
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 79 of 79 v1.1 requirements (100%)

**Adjusted:**
- CALC-09 terminology: "Leefgeld" → "Disposable Income" for English clarity
- EXP-02 generalization: "Belgium costs" → "Work Travel" for flexibility
- Phase 7.2 insertion: Comprehensive UI/UX polish beyond original scope

**Dropped:** None — all requirements delivered

**Technical notes:**
- Excel generation requires manual Node.js execution (consider client-side in v2)
- Three IRPF calculation functions intentional (main engine, scenario what-if, Excel verification)

---
_Archived: 2026-02-03 as part of v1.1 milestone completion_
