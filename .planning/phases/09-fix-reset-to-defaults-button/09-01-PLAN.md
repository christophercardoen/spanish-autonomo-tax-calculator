---
phase: 09-fix-reset-to-defaults-button
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - autonomo_dashboard.html
autonomous: true

must_haves:
  truths:
    - "Reset to Defaults button executes without JavaScript errors"
    - "All scenarios reset to A-E presets when button clicked"
    - "Custom scenarios removed after reset"
    - "Scenario cards and comparison table display correctly after reset"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Fixed resetScenarios() function"
      contains: "function resetScenarios"
  key_links:
    - from: "resetScenarios()"
      to: "renderScenarioCards()"
      via: "direct function call"
      pattern: "renderScenarioCards\\(\\)"
    - from: "renderScenarioCards()"
      to: "getSortedScenarios()"
      via: "lazy recalculation"
      pattern: "getSortedScenarios\\(\\)"
---

<objective>
Fix the "Reset to Defaults" button in the Scenarios section by removing the invalid function call.

Purpose: The resetScenarios() function at line 6656 calls recalculateAllScenarios() which does not exist, causing a JavaScript error when users click the button. The codebase uses lazy recalculation via getSortedScenarios(), making explicit recalculation unnecessary.

Output: Working Reset to Defaults button that clears custom scenarios and restores A-E presets.
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-fix-reset-to-defaults-button/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove invalid function call and update comment</name>
  <files>autonomo_dashboard.html</files>
  <action>
Locate the resetScenarios() function (around line 6639).

Current buggy code (lines 6655-6656):
```javascript
      // Recalculate all scenarios
      recalculateAllScenarios();
```

Replace with:
```javascript
      // Re-render (recalculation happens automatically via getSortedScenarios())
```

This removes the non-existent function call. The comment update explains why explicit recalculation is unnecessary - the render functions call getSortedScenarios() which computes results on-the-fly via calculateScenarioResults().

WHY this works: The codebase uses lazy recalculation. When renderScenarioCards() is called, it invokes getSortedScenarios() which maps all scenarios through calculateScenarioResults(). No explicit recalculation step is needed.

Do NOT:
- Implement a recalculateAllScenarios() function (unnecessary, would duplicate logic)
- Modify the confirmation dialog
- Change localStorage clearing behavior
- Alter the scenarioState reinitialization
  </action>
  <verify>
1. Open autonomo_dashboard.html in browser
2. Open browser DevTools console (F12)
3. Navigate to Scenarios tab
4. Create a custom scenario (click "New Scenario")
5. Edit an existing scenario
6. Click "Reset to Defaults" button
7. Verify: No JavaScript errors in console
8. Verify: Only A-E scenarios remain (custom scenario gone)
9. Verify: Edited values reverted to defaults
10. Verify: Scenario cards display correctly
11. Verify: Comparison table displays correctly
12. Refresh page and verify scenarios remain as defaults (localStorage cleared correctly)
  </verify>
  <done>
Reset to Defaults button works without errors. Custom scenarios removed. All presets restored. Cards and table render correctly.
  </done>
</task>

</tasks>

<verification>
Functional verification:
1. No JavaScript errors when clicking Reset to Defaults
2. Custom scenarios are removed
3. Edited scenarios revert to A-E presets
4. UI renders correctly after reset
5. localStorage is cleared (changes persist after refresh)

Code verification:
- Line 6656 no longer contains recalculateAllScenarios()
- Comment accurately describes lazy recalculation pattern
</verification>

<success_criteria>
1. resetScenarios() executes without throwing ReferenceError
2. Confirmation dialog still appears before reset
3. After reset: scenarioState.scenarios contains only A, B, C, D, E
4. After reset: localStorage key "autonomo_scenarios_v1" is removed
5. After reset: scenario cards show A-E with correct preset values
6. After reset: comparison table shows A-E with correct calculations
</success_criteria>

<output>
After completion, create `.planning/phases/09-fix-reset-to-defaults-button/09-01-SUMMARY.md`
</output>
