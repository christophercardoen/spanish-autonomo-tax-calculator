---
phase: 7.1-critical-bug-fixes
plan: 03
type: execute
wave: 1
depends_on:
  - "7.1-02"
files_modified:
  - autonomo_dashboard.html
autonomous: true

must_haves:
  truths:
    - "User can select an entire week by clicking a week selector button"
    - "User can select an entire month by clicking a month selector button"
    - "Selected days show visual highlight"
    - "Selection indicator shows count of selected days"
    - "Clear button removes all selections"
    - "Bulk status picker opens when days are selected"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Enhanced calendar multi-select"
      contains: "selectWeek"
  key_links:
    - from: "selectWeek function"
      to: "selectedDates Set"
      via: "Set.add()"
      pattern: "selectedDates\\.add"
    - from: "selectMonth function"
      to: "selectedDates Set"
      via: "Set.add()"
      pattern: "selectedDates\\.add"
    - from: "selection indicator"
      to: "selectedDates.size"
      via: "textContent update"
      pattern: "selectionCount.*textContent"
---

<objective>
Enhance calendar multi-select with week and month selection capabilities, plus a selection indicator showing how many days are selected.

Purpose: Users need to quickly select multiple days for bulk status changes. Shift-click range selection exists but week/month selection is faster for common patterns.

Output: Week selector buttons, month "Select All" button, selection count indicator with clear function
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-critical-bug-fixes/07.1-RESEARCH.md
@autonomo_dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add selection indicator and CSS styles</name>
  <files>autonomo_dashboard.html</files>
  <action>
1. **Add selection indicator CSS** (in the calendar styles section, after existing calendar CSS):

```css
/* ===========================================
   CALENDAR MULTI-SELECT ENHANCEMENTS (BUG-05)
   =========================================== */

/* Selection Indicator Bar */
.selection-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--accent);
  color: var(--bg);
  font-weight: 600;
  border-radius: 8px;
  margin-bottom: 16px;
}

.selection-indicator.hidden {
  display: none;
}

.selection-indicator .clear-btn {
  padding: 6px 12px;
  background: rgba(0, 0, 0, 0.2);
  border: none;
  border-radius: 4px;
  color: var(--bg);
  font-size: 0.85rem;
  cursor: pointer;
  transition: background 0.2s;
}

.selection-indicator .clear-btn:hover {
  background: rgba(0, 0, 0, 0.3);
}

/* Week Selector Button */
.week-selector {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  padding: 0;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: var(--bg-surface);
  color: var(--text-muted);
  font-size: 0.7rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.week-selector:hover {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
}

/* Month Select All Button */
.month-select-all {
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.2s;
}

.month-select-all:hover {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
}

/* Calendar grid with week selectors */
.calendar-row {
  display: grid;
  grid-template-columns: 24px repeat(7, 1fr);
  gap: 4px;
  align-items: center;
}

/* Adjust day header row */
.day-headers {
  display: grid;
  grid-template-columns: 24px repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 8px;
}

.day-header {
  text-align: center;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-muted);
  padding: 4px;
}

/* Selected day highlight */
.calendar-day.selected {
  outline: 2px solid var(--accent);
  outline-offset: -2px;
  background: rgba(79, 209, 139, 0.2);
}
```

2. **Add selection indicator HTML** (in the calendar section, before the month navigation):

Find the calendar panel HTML (around line 2270) and add the selection indicator after the panel header:

```html
<!-- Selection Indicator (shows when days are selected) -->
<div id="selectionIndicator" class="selection-indicator hidden">
  <span><span id="selectionCount">0</span> days selected</span>
  <button type="button" class="clear-btn" onclick="clearSelection()">Clear</button>
  <button type="button" class="clear-btn" onclick="openBulkPicker()">Set Status</button>
</div>
```
  </action>
  <verify>
1. Open autonomo_dashboard.html in browser
2. Navigate to Calendar tab
3. Selection indicator should be hidden initially
4. Shift-click to select a range of days
5. Selection indicator should appear with count
  </verify>
  <done>
- Selection indicator HTML element exists
- CSS styles for indicator, week selector, month selector defined
- Indicator hidden by default
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement week and month selection functions</name>
  <files>autonomo_dashboard.html</files>
  <action>
1. **Add selectWeek function** (in the calendar JavaScript section, after existing selection code):

```javascript
/**
 * Select all days in a week
 * @param {string} weekStartKey - ISO date key of week's Monday
 */
function selectWeek(weekStartKey) {
  const start = new Date(weekStartKey);

  // Clear existing selection and add week's days
  selectedDates.clear();

  for (let i = 0; i < 7; i++) {
    const day = new Date(start);
    day.setDate(start.getDate() + i);

    // Only include valid range (Feb-Dec 2026)
    if (day.getFullYear() === 2026 && day.getMonth() >= 1) {
      selectedDates.add(toISODateKey(day));
    }
  }

  renderCalendar();
  updateSelectionIndicator();

  if (selectedDates.size > 0) {
    openBulkPicker();
  }
}

/**
 * Select all days in a month
 * @param {number} month - Month index (0-11)
 */
function selectMonth(month) {
  const year = 2026;
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);  // Last day of month

  selectedDates.clear();

  const current = new Date(firstDay);
  while (current <= lastDay) {
    selectedDates.add(toISODateKey(current));
    current.setDate(current.getDate() + 1);
  }

  renderCalendar();
  updateSelectionIndicator();
  openBulkPicker();
}

/**
 * Update selection indicator visibility and count
 */
function updateSelectionIndicator() {
  const indicator = document.getElementById('selectionIndicator');
  const countEl = document.getElementById('selectionCount');

  if (!indicator || !countEl) return;

  if (selectedDates.size > 0) {
    countEl.textContent = selectedDates.size;
    indicator.classList.remove('hidden');
  } else {
    indicator.classList.add('hidden');
  }
}

/**
 * Clear all selected dates
 */
function clearSelection() {
  selectedDates.clear();
  renderCalendar();
  updateSelectionIndicator();
}
```

2. **Update existing selection code to call updateSelectionIndicator**:

Find the handleDayClick function (or wherever selectedDates is modified) and add calls to updateSelectionIndicator() after modifying the selection.

Around line 3125-3160, update the shift-click range selection code:
```javascript
// After adding dates to selectedDates...
renderCalendar();
updateSelectionIndicator();
```

Around line 3195 (after clearing selection):
```javascript
selectedDates.clear();
renderCalendar();
updateSelectionIndicator();
```

Around line 3224 (after bulk apply):
```javascript
selectedDates.clear();
renderCalendar();
updateSelectionIndicator();
updateCountDisplays();
```
  </action>
  <verify>
1. Open browser console
2. Test `selectWeek('2026-03-02')` - should select 7 days
3. Test `selectMonth(2)` - should select all of March
4. Test `clearSelection()` - should clear all
  </verify>
  <done>
- selectWeek function selects all days in a week
- selectMonth function selects all days in a month
- updateSelectionIndicator shows/hides indicator with count
- clearSelection clears all and updates indicator
  </done>
</task>

<task type="auto">
  <name>Task 3: Update calendar rendering with week and month selectors</name>
  <files>autonomo_dashboard.html</files>
  <action>
1. **Update renderCalendar function** to include week selectors in each row:

Find the renderCalendar function (around line 2850) and update the row rendering:

The calendar currently renders weeks as rows. Add a week selector button at the start of each row.

Update the day headers to include an empty cell for alignment:
```javascript
// Day headers with empty cell for week selector column
const dayHeaders = `
  <div class="day-headers">
    <div class="day-header"></div>
    <div class="day-header">Mon</div>
    <div class="day-header">Tue</div>
    <div class="day-header">Wed</div>
    <div class="day-header">Thu</div>
    <div class="day-header">Fri</div>
    <div class="day-header">Sat</div>
    <div class="day-header">Sun</div>
  </div>
`;
```

When rendering each week row, prepend a week selector button:
```javascript
// For each week row, calculate the Monday date and add selector
const weekStartKey = toISODateKey(firstDayOfWeek);
const weekSelector = `<button type="button" class="week-selector"
  onclick="selectWeek('${weekStartKey}')"
  title="Select entire week"
  aria-label="Select week starting ${weekStartKey}">W</button>`;
```

2. **Add month "Select All" button** to the month header:

Find where the month header is rendered (the navigation with month name) and add a "Select All" button:

```javascript
// In the month header rendering
const monthHeader = `
  <div class="month-header">
    <button class="nav-btn" onclick="navigateMonth(-1)" ${monthIndex <= 1 ? 'disabled' : ''}>&lt;</button>
    <div class="month-title">
      <span>${monthName} 2026</span>
      <button type="button" class="month-select-all" onclick="selectMonth(${monthIndex})">Select All</button>
    </div>
    <button class="nav-btn" onclick="navigateMonth(1)" ${monthIndex >= 11 ? 'disabled' : ''}>&gt;</button>
  </div>
`;
```

3. **Ensure selected days have the 'selected' class**:

In the day cell rendering, add the selected class:
```javascript
const isSelected = selectedDates.has(dateKey);
const selectedClass = isSelected ? 'selected' : '';
// ... use selectedClass in the day cell class attribute
```

This may already exist - verify it's working correctly.
  </action>
  <verify>
1. Open autonomo_dashboard.html in browser
2. Navigate to Calendar tab
3. Confirm each week row has a "W" button on the left
4. Click "W" button - all 7 days of that week should highlight
5. Bulk picker should open automatically
6. Confirm month header has "Select All" button
7. Click "Select All" - all days in month should highlight
8. Verify selection indicator updates with correct count
9. Click "Clear" button - all selections removed
  </verify>
  <done>
- Week selector "W" buttons appear at start of each calendar row
- Clicking "W" selects entire week and opens bulk picker
- "Select All" button appears in month header
- Clicking "Select All" selects entire month
- Selected days show visual highlight
- Selection indicator shows count with Clear button
  </done>
</task>

</tasks>

<verification>
1. **Week Selection:**
   - Navigate to Calendar tab, any month
   - Click "W" button for any week
   - All 7 days of that week highlight
   - Selection indicator shows "7 days selected"
   - Bulk picker dialog opens

2. **Month Selection:**
   - Click "Select All" in month header
   - All days in month highlight
   - Selection indicator shows correct count (28-31 depending on month)
   - Bulk picker dialog opens

3. **Combined with Shift-Click:**
   - Click a day
   - Shift-click another day (range selection)
   - Selection indicator shows correct count
   - Can clear and try week selection

4. **Clear Function:**
   - Select some days
   - Click "Clear" button
   - All selections removed
   - Indicator hides

5. **Persistence:**
   - Select days, apply status via bulk picker
   - Days maintain their new status
   - Selection clears after applying

6. **Edge Cases:**
   - Week at month boundary (some days in prev/next month)
   - First week of February (partial week)
   - December (last valid month)
</verification>

<success_criteria>
- BUG-05: Calendar supports multi-select with week and month selection
- Week selector button on each calendar row
- Month "Select All" button in header
- Selection indicator with count and clear button
- Visual highlighting for selected days
- Bulk picker opens after selection
- Works correctly at month boundaries
- No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-critical-bug-fixes/7.1-03-SUMMARY.md`
</output>
