---
phase: 16-calendar-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - autonomo_dashboard.html
autonomous: true

must_haves:
  truths:
    - "User can click a calendar day to open the day editor modal"
    - "User can tag a day with client, project, location, and notes"
    - "Changes persist to IndexedDB and reflect immediately in calendar"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Day editor modal HTML"
      contains: "dayEditorModal"
    - path: "autonomo_dashboard.html"
      provides: "Day editor functions"
      contains: "openDayEditor"
  key_links:
    - from: "openDayEditor"
      to: "CalendarManager.getDay"
      via: "load existing data"
      pattern: "CalendarManager\\.getDay"
    - from: "saveDayEditor"
      to: "CalendarManager.saveDay"
      via: "persist changes"
      pattern: "CalendarManager\\.saveDay"
---

<objective>
Create day editor modal for tagging calendar days with client, project, location, and notes.

Purpose: Enable users to associate work days with clients/projects for billing and tracking
Output: Modal UI with dropdowns for client/project, radio buttons for location, textarea for notes
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-calendar-enhancement/16-RESEARCH.md
@.planning/phases/16-calendar-enhancement/16-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Day Editor Modal HTML and CSS</name>
  <files>autonomo_dashboard.html</files>
  <action>
Add modal HTML after existing modals (around line 6200) with:

```html
<!-- Day Editor Modal -->
<div id="dayEditorModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
      <h3 id="dayEditorTitle">Edit Day</h3>
      <button type="button" class="modal-close" onclick="closeDayEditor()">&times;</button>
    </div>
    <form id="dayEditorForm" onsubmit="saveDayEditor(event)">
      <input type="hidden" id="dayEditorDate" />

      <!-- Location Selection -->
      <div class="form-group">
        <label>Location</label>
        <div class="radio-group" id="dayEditorLocationGroup">
          <label class="radio-option">
            <input type="radio" name="dayLocation" value="belgium" />
            <span>üáßüá™ Belgium</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="dayLocation" value="spain" />
            <span>üá™üá∏ Spain</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="dayLocation" value="travel" />
            <span>‚úàÔ∏è Travel</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="dayLocation" value="other" />
            <span>üìç Other</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="dayLocation" value="unset" checked />
            <span>‚¨ú Unset</span>
          </label>
        </div>
      </div>

      <!-- Client Selection -->
      <div class="form-group">
        <label for="dayEditorClient">Client</label>
        <select id="dayEditorClient" onchange="updateProjectDropdown()">
          <option value="">-- No client --</option>
        </select>
      </div>

      <!-- Project Selection -->
      <div class="form-group">
        <label for="dayEditorProject">Project</label>
        <select id="dayEditorProject" disabled>
          <option value="">-- Select client first --</option>
        </select>
      </div>

      <!-- Notes -->
      <div class="form-group">
        <label for="dayEditorNotes">Notes</label>
        <textarea id="dayEditorNotes" rows="2" placeholder="Optional notes for this day"></textarea>
      </div>

      <!-- Linked Expenses (read-only info) -->
      <div class="form-group" id="dayEditorExpensesInfo" style="display: none;">
        <label>Linked Expenses</label>
        <div id="dayEditorExpensesCount" class="info-text"></div>
      </div>

      <!-- Actions -->
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeDayEditor()">Cancel</button>
        <button type="button" class="btn btn-danger" onclick="clearDayEditor()" style="margin-right: auto;">Clear Day</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>
```

Add CSS for the modal elements (in style section):

```css
.radio-group {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.radio-option {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 0.75rem;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.radio-option:hover {
  background: var(--hover-bg);
}

.radio-option input[type="radio"] {
  margin: 0;
}

.radio-option input[type="radio"]:checked + span {
  color: var(--accent-color);
  font-weight: 500;
}

.info-text {
  color: var(--text-secondary);
  font-size: 0.875rem;
}
```
  </action>
  <verify>
Page loads without errors, modal HTML exists in DOM (check Elements panel)
  </verify>
  <done>
Day editor modal with all form fields rendered and styled
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Day Editor JavaScript Functions</name>
  <files>autonomo_dashboard.html</files>
  <action>
Add day editor functions after CalendarManager (around line 12700):

1. openDayEditor(dateKey) async function:
   - Set modal title to formatted date (e.g., "February 15, 2026")
   - Store dateKey in hidden input
   - Load existing day data via CalendarManager.getDay(dateKey)
   - Pre-select location radio if day has location
   - Populate client dropdown with ClientManager.getClients()
   - If day has client_id, pre-select it and load projects
   - If day has project_id, pre-select it
   - Set notes textarea value
   - Show expense count if > 0 (CalendarManager.getLinkedExpenseCount)
   - Show modal (display: block)

2. closeDayEditor() function:
   - Hide modal (display: none)
   - Reset form fields

3. updateProjectDropdown() async function:
   - Get selected client_id from dropdown
   - If no client selected, disable project dropdown, set to "-- Select client first --"
   - If client selected, fetch projects via ProjectManager.getProjectsByClient(clientId)
   - Populate project dropdown with active projects
   - Enable dropdown

4. saveDayEditor(event) async function:
   - event.preventDefault()
   - Get dateKey from hidden input
   - Get selected location from radio
   - Get client_id and project_id from dropdowns (null if none)
   - Get notes from textarea
   - Call CalendarManager.saveDay(dateKey, { location, client_id, project_id, notes })
   - Close modal
   - Re-render calendar (call renderCalendar())
   - Show success feedback briefly

5. clearDayEditor() async function:
   - Get dateKey from hidden input
   - Call CalendarManager.deleteDays([dateKey])
   - Close modal
   - Re-render calendar

6. Update existing renderCalendar() to call openDayEditor(dateKey) on day cell click:
   - Modify the day cell onclick handler
   - Currently cycles status; change to open modal
   - Keep shift-click for bulk selection (existing behavior)
  </action>
  <verify>
Test flow:
1. Click on any calendar day - modal opens
2. Select location - radio highlights
3. Select client - project dropdown enables and populates
4. Enter notes
5. Click Save - modal closes, calendar updates
6. Click same day again - modal shows saved values
  </verify>
  <done>
Day editor opens with existing data, saves to IndexedDB, reflects changes in calendar
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Calendar Rendering to Show Client Tags</name>
  <files>autonomo_dashboard.html</files>
  <action>
Modify renderCalendar() to display client information:

1. Load days for current month via CalendarManager.getDaysForMonth()

2. For each day cell with data, show:
   - Location emoji (existing)
   - Client name abbreviation (first 3 letters) if client_id set
   - Small badge with linked expense count if > 0

3. Update day cell HTML structure:
   ```html
   <div class="day-cell" data-date="${dateKey}">
     <span class="day-number">${dayNum}</span>
     <span class="day-status">${emoji}</span>
     <span class="day-client">${clientAbbrev}</span>
     ${expenseCount > 0 ? `<span class="day-expense-badge">${expenseCount}</span>` : ''}
   </div>
   ```

4. Add CSS for client tag and expense badge:
   ```css
   .day-client {
     font-size: 0.65rem;
     color: var(--text-secondary);
     position: absolute;
     bottom: 2px;
     left: 2px;
   }

   .day-expense-badge {
     position: absolute;
     top: 2px;
     right: 2px;
     background: var(--accent-color);
     color: white;
     font-size: 0.6rem;
     padding: 0 3px;
     border-radius: 50%;
     min-width: 12px;
     text-align: center;
   }
   ```

5. Preload client names at render time to avoid N+1 queries:
   - Call ClientManager.getClients() once
   - Build lookup map { id: name }
   - Use map for client abbreviations
  </action>
  <verify>
Visual check:
1. Day with client shows abbreviation at bottom
2. Location emoji still displays correctly
3. Expense badge appears when linked (Phase 17 will populate)
  </verify>
  <done>
Calendar cells show location, client tag, and expense badge when applicable
  </done>
</task>

</tasks>

<verification>
1. Modal opens when clicking any day
2. Modal shows correct date in title
3. Location, client, project, notes all save and reload correctly
4. Calendar updates immediately after save
5. Clear Day removes all data for that day
6. Client tags visible on calendar cells
</verification>

<success_criteria>
- Day editor modal fully functional with all fields
- Click day -> edit -> save -> see changes flow works
- Client/project tagging persists correctly
- Calendar cells show client abbreviations
</success_criteria>

<output>
After completion, create `.planning/phases/16-calendar-enhancement/16-02-SUMMARY.md`
</output>
