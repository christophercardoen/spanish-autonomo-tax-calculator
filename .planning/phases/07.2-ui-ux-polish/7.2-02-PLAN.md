---
phase: 7.2-ui-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - autonomo_dashboard.html
autonomous: true

must_haves:
  truths:
    - "User can add/edit/delete travel expenses like any other expense"
    - "User does not see a Low/High toggle for Belgium costs"
    - "User sees 'Work Travel Expenses' section with editable items"
    - "All 5 scenarios calculate correctly after expense restructure"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Generalized expense system without Belgium hardcoding"
      contains: "Work Travel Expenses"
  key_links:
    - from: "expense categories"
      to: "calculation functions"
      via: "category type check"
      pattern: "work-travel"
---

<objective>
Remove Belgium hardcoding to create a generalized expense system

Purpose: The current design hardcodes Belgium as a special case with Low/High toggle. This should be converted to a flexible expense system where Belgium travel costs are regular deductible expenses. Makes the tool usable for other cross-border scenarios.

Output: autonomo_dashboard.html with generalized expense system
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@autonomo_dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Expense Data Structure</name>
  <files>autonomo_dashboard.html</files>
  <action>
Update DEFAULT_EXPENSES to replace Belgium toggle logic with standard expense items.

1. **Change category name in DEFAULT_EXPENSES**:
   - Change `category: 'belgium'` to `category: 'work-travel'`
   - Replace the Belgium section with:
```javascript
'work-travel': [
  { id: 'belgium-travel-low', name: 'Belgium Travel (Standard)', amount: 1000,
    description: '3 days, 1 flight (Mon-Wed pattern)', editable: true },
  { id: 'belgium-travel-high', name: 'Belgium Travel (Extended)', amount: 2500,
    description: '17 days, 4 flights (full week pattern)', editable: true }
]
```

2. **Remove belgiumPattern from expenseData** - Delete the belgiumPattern property from the default expense data structure.

3. **Add migration logic** at top of loadExpenseData():
```javascript
function migrateExpenseData(data) {
  // Migrate old belgiumPattern to new work-travel expenses
  if (data.belgiumPattern !== undefined) {
    const amount = data.belgiumPattern === 'high' ? 2500 : 1000;
    if (!data.expenses) data.expenses = {};
    if (!data.expenses['work-travel']) {
      data.expenses['work-travel'] = [
        { id: 'belgium-travel-migrated', name: 'Belgium Travel', amount: amount,
          description: 'Migrated from pattern', editable: true }
      ];
    }
    delete data.belgiumPattern;
  }
  return data;
}
```

This task ONLY changes data structures, not rendering or calculation functions.
  </action>
  <verify>
1. Check DEFAULT_EXPENSES has 'work-travel' category
2. Check no 'belgium' category remains in DEFAULT_EXPENSES
3. Check migration function exists
4. No console errors on page load
  </verify>
  <done>
DEFAULT_EXPENSES updated with work-travel category. Migration logic handles old belgiumPattern data. Data structure ready for UI changes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Expense Rendering</name>
  <files>autonomo_dashboard.html</files>
  <action>
Update the expense section rendering to remove pill toggle and use standard expense list.

1. **Remove the pill-toggle pattern** - Find and delete the Low (1K) / High (2.5K) toggle HTML/CSS/JS from Belgium section header.

2. **Change section title**:
   - Change "Belgium Labor Costs" to "Work Travel Expenses"
   - Update border color from `var(--belgium)` to `var(--positive)` or `var(--accent)`

3. **Update expense section rendering function**:
   - Remove special-case code for Belgium/belgium category
   - Render 'work-travel' section like 'spain' and 'private' sections
   - Allow adding/removing work travel expenses like other categories

4. **Remove toggleBelgiumPattern function** (or rename/repurpose if needed).

5. **Update CSS** - Remove any Belgium-pill-toggle specific styles.

Verify the expense section shows individual editable items instead of toggle.
  </action>
  <verify>
1. Open in browser - no "Belgium Labor Costs" section with toggle
2. See "Work Travel Expenses" section with individual expense items
3. Can click "Add Expense" to add new work travel expense
4. Can delete existing work travel expenses
5. No console errors
  </verify>
  <done>
Pill toggle removed. Work Travel Expenses section renders as standard expense list. Add/delete functionality works for work travel expenses.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Calculation Functions</name>
  <files>autonomo_dashboard.html</files>
  <action>
Update all calculation functions to use new work-travel category.

1. **Update calculateBelgiumExpenses()** (or rename to calculateWorkTravelExpenses):
   - Sum all active expenses in 'work-travel' category
   - Remove the pattern === 'low' ? 1000 : 2500 logic
   - Return total of work-travel expense amounts

2. **Update SCENARIO_PRESETS**:
   - Remove `belgiumPattern: 'low'` and `belgiumPattern: 'high'` from presets
   - Add expense overrides for work-travel category:
     - Scenarios A/B: default to belgium-travel-low (1K)
     - Scenarios C/D/E: default to belgium-travel-high (2.5K)

3. **Update scenario calculation functions**:
   - `calculateFullIRPFWithBreakdown()` - use work-travel expense sum
   - `calculateFullIRPFWithFiscal()` - same update
   - Remove any direct references to belgiumPattern

4. **Update comparison table and scenario card rendering**:
   - Remove Belgium pattern display
   - Show work travel costs as part of expense breakdown

5. **Update edit modal**:
   - Remove Belgium pattern toggle from modal
   - Work travel expenses edited via Expenses tab

6. **Verify all calculations still produce correct values**:
   - Scenario A: ~€3,000 revenue, ~€1,750 total expenses (750+1000)
   - Scenario C: ~€9,000 revenue, ~€5,500 total expenses (3000+2500)

After changes, grep for these patterns to confirm complete:
- grep -c "belgiumPattern" (should only be in migration code)
- grep -c "work-travel" (should appear in category definitions and calculations)
  </action>
  <verify>
1. Run through each scenario (A-E) - calculations match expected values
2. Edit a scenario - save works
3. Custom scenario creation works
4. Comparison table shows correct data
5. grep -c "belgiumPattern" returns count only in migration code
6. No console errors during scenario operations
  </verify>
  <done>
All calculation functions updated for work-travel category. Scenario presets use expense overrides. All 5 scenarios calculate correctly. belgiumPattern only in migration code.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. No pill-toggle for Belgium costs anywhere
2. Work Travel Expenses section allows adding/editing individual items
3. All 5 scenarios produce correct calculations:
   - A: ~€3K revenue, 1K work travel
   - B: ~€6K revenue, 1K work travel
   - C: ~€9K revenue, 2.5K work travel
   - D: ~€12K revenue, 2.5K work travel
   - E: ~€18K revenue, 2.5K work travel
4. grep -c "belgiumPattern" shows only migration code references
</verification>

<success_criteria>
1. Belgium Labor Costs section replaced with Work Travel Expenses
2. No Low/High toggle - individual expense items instead
3. All scenario calculations remain accurate
4. User can add custom work travel expenses
5. Backwards compatible with existing localStorage data
</success_criteria>

<output>
After completion, create `.planning/phases/07.2-ui-ux-polish/7.2-02-SUMMARY.md`
</output>
