---
phase: 7.1-critical-bug-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - autonomo_dashboard.html
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Info tooltips open as centered modals with background blur"
    - "Clicking outside the tooltip modal or pressing Escape closes it"
    - "Tooltip content is readable and not cut off"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Modal-style tooltips with blur backdrop"
      contains: "tooltip-modal"
  key_links:
    - from: "term-tooltip click"
      to: "openTooltipModal function"
      via: "click handler"
      pattern: "openTooltipModal"
---

<objective>
Redesign tooltips as centered modals with background blur

Purpose: Current tooltips are positioned relative to trigger elements and can get cut off or appear in awkward positions. Users need a cleaner, more readable tooltip presentation.
Output: Click-triggered modal tooltips with blur backdrop, centered on screen
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@autonomo_dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tooltip modal infrastructure</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Add tooltip modal HTML element (before closing body tag):
       ```html
       <!-- Tooltip Modal -->
       <dialog id="tooltipModal" class="tooltip-modal">
         <div class="tooltip-modal-content">
           <h3 id="tooltipModalTitle" class="tooltip-modal-title"></h3>
           <p id="tooltipModalText" class="tooltip-modal-text"></p>
           <button type="button" class="tooltip-modal-close" onclick="closeTooltipModal()">Got it</button>
         </div>
       </dialog>
       ```

    2. Add CSS for tooltip modal (in style section):
       ```css
       /* Tooltip Modal (replaces hover tooltips) */
       .tooltip-modal {
         position: fixed;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         max-width: 400px;
         width: 90%;
         padding: 0;
         border: none;
         border-radius: 12px;
         background: var(--bg-surface);
         box-shadow: 0 8px 32px rgba(0,0,0,0.4);
       }

       .tooltip-modal::backdrop {
         background: rgba(0, 0, 0, 0.6);
         backdrop-filter: blur(4px);
         -webkit-backdrop-filter: blur(4px);
       }

       .tooltip-modal-content {
         padding: 1.5rem;
       }

       .tooltip-modal-title {
         margin: 0 0 0.75rem 0;
         color: var(--accent);
         font-size: 1.1rem;
         font-family: var(--font-sans);
       }

       .tooltip-modal-text {
         margin: 0 0 1.25rem 0;
         color: var(--text);
         font-size: 0.95rem;
         line-height: 1.6;
       }

       .tooltip-modal-close {
         display: block;
         width: 100%;
         padding: 0.75rem;
         background: var(--accent);
         border: none;
         border-radius: 8px;
         color: var(--bg);
         font-weight: 600;
         cursor: pointer;
         transition: opacity 0.2s;
       }

       .tooltip-modal-close:hover {
         opacity: 0.9;
       }
       ```

    3. Add JavaScript functions for tooltip modal:
       ```javascript
       /**
        * Open tooltip modal with title and text
        * @param {string} title - Tooltip title
        * @param {string} text - Tooltip explanation text
        */
       function openTooltipModal(title, text) {
         const dialog = document.getElementById('tooltipModal');
         const titleEl = document.getElementById('tooltipModalTitle');
         const textEl = document.getElementById('tooltipModalText');

         if (dialog && titleEl && textEl) {
           titleEl.textContent = title;
           textEl.textContent = text;
           dialog.showModal();
         }
       }

       /**
        * Close tooltip modal
        */
       function closeTooltipModal() {
         const dialog = document.getElementById('tooltipModal');
         if (dialog) {
           dialog.close();
         }
       }

       // Close modal on backdrop click
       document.addEventListener('click', (e) => {
         const dialog = document.getElementById('tooltipModal');
         if (e.target === dialog) {
           dialog.close();
         }
       });
       ```

    4. Update createTooltip() function to use click instead of hover:
       ```javascript
       function createTooltip(term, displayText) {
         const tooltip = TOOLTIPS[term];
         if (!tooltip) return displayText;
         // Use onclick to open modal instead of hover tooltip
         return `<span class="term-tooltip-trigger" tabindex="0"
           onclick="openTooltipModal('${tooltip.title.replace(/'/g, "\\'")}', '${tooltip.text.replace(/'/g, "\\'")}')"
           onkeydown="if(event.key==='Enter')openTooltipModal('${tooltip.title.replace(/'/g, "\\'")}', '${tooltip.text.replace(/'/g, "\\'")}')"
           role="button"
           aria-label="Learn more about ${tooltip.title}">
           ${displayText}<span class="info-icon">i</span>
         </span>`;
       }
       ```

    5. Update CSS for tooltip trigger (replace old .term-tooltip styles):
       ```css
       /* Tooltip trigger (click to open modal) */
       .term-tooltip-trigger {
         cursor: pointer;
         border-bottom: 1px dotted var(--text-muted);
         position: relative;
         display: inline;
       }

       .term-tooltip-trigger:hover,
       .term-tooltip-trigger:focus {
         border-bottom-color: var(--accent);
         color: var(--accent);
       }

       .term-tooltip-trigger .info-icon {
         display: inline-flex;
         align-items: center;
         justify-content: center;
         width: 14px;
         height: 14px;
         margin-left: 4px;
         background: var(--accent);
         color: var(--bg);
         border-radius: 50%;
         font-size: 10px;
         font-weight: bold;
         vertical-align: middle;
       }
       ```

    6. Remove old hover tooltip CSS:
       - Delete [role="tooltip"] styles
       - Delete [role="tooltip"]::after (arrow)
       - Delete .term-tooltip:hover [role="tooltip"] etc.
       - Delete .tooltip-title (now in modal)
       - Keep .term-tooltip class only if used elsewhere, otherwise remove
  </action>
  <verify>
    - Open autonomo_dashboard.html in browser
    - Navigate to Details tab (where tooltips are used)
    - Click on a technical term with tooltip (e.g., "IRPF", "RETA")
    - Modal should appear centered with blur backdrop
    - "Got it" button should close the modal
    - Clicking outside should close the modal
    - Pressing Escape should close the modal
  </verify>
  <done>
    - Tooltip modal HTML element exists
    - Modal CSS provides centered positioning with blur backdrop
    - openTooltipModal and closeTooltipModal functions work
    - createTooltip generates click-triggered tooltips
    - Old hover tooltip styles removed
  </done>
</task>

<task type="auto">
  <name>Task 2: Update source hints to use modal pattern</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Update the sourceHint() function to use the modal pattern:
       ```javascript
       function sourceHint(sourceKey) {
         const s = SOURCES[sourceKey];
         if (!s) return '';
         const title = s.source;
         const text = s.note;
         return `<span class="source-hint-trigger" tabindex="0"
           onclick="openTooltipModal('${title.replace(/'/g, "\\'")}', '${text.replace(/'/g, "\\'")}')"
           onkeydown="if(event.key==='Enter')openTooltipModal('${title.replace(/'/g, "\\'")}', '${text.replace(/'/g, "\\'")}')"
           role="button"
           aria-label="View source: ${title}">i</span>`;
       }
       ```

    2. Update CSS for source hint trigger:
       ```css
       /* Source citation hint (click to open modal) */
       .source-hint-trigger {
         display: inline-flex;
         align-items: center;
         justify-content: center;
         width: 16px;
         height: 16px;
         margin-left: 4px;
         background: rgba(74, 222, 128, 0.2);
         color: var(--accent);
         border-radius: 50%;
         font-size: 10px;
         font-weight: bold;
         cursor: pointer;
         vertical-align: middle;
         transition: all 0.2s;
       }

       .source-hint-trigger:hover,
       .source-hint-trigger:focus {
         background: var(--accent);
         color: var(--bg);
       }
       ```

    3. Remove old source-hint hover CSS:
       - Delete .source-hint:hover::after content/positioning styles
       - Keep basic .source-hint styling only if needed for compatibility

    4. Update the entry/exit day source hint in calendar section:
       - Find the inline data-tooltip usage in annual count display
       - Replace with onclick handler using openTooltipModal
  </action>
  <verify>
    - Source hint (i) icons are clickable
    - Clicking opens modal with source title and note
    - Calendar entry/exit hint works as modal
    - All source citations use consistent modal pattern
  </verify>
  <done>
    - sourceHint() generates click-triggered elements
    - Source hints styled as small circular buttons
    - Calendar entry/exit warning uses modal
    - Consistent tooltip experience across entire app
  </done>
</task>

</tasks>

<verification>
1. Tooltip Modal Functionality:
   - [ ] Modal opens on click for technical terms
   - [ ] Modal opens on click for source citations
   - [ ] Modal displays title and text correctly
   - [ ] "Got it" button closes modal
   - [ ] Clicking backdrop closes modal
   - [ ] Escape key closes modal
   - [ ] Focus trap works (Tab stays in modal)

2. Visual Design:
   - [ ] Modal is centered on screen
   - [ ] Background has blur effect
   - [ ] Modal has proper spacing and typography
   - [ ] Info icons (i) are visible and styled

3. Accessibility:
   - [ ] Triggers are keyboard accessible (Enter key)
   - [ ] Triggers have proper ARIA labels
   - [ ] Focus returns to trigger after modal closes
</verification>

<success_criteria>
- BUG-02 is resolved: tooltips open as centered modals with blur backdrop
- All technical term tooltips use modal pattern
- All source citation hints use modal pattern
- Calendar entry/exit warning uses modal pattern
- Consistent, accessible tooltip experience throughout the app
</success_criteria>

<output>
After completion, create `.planning/phases/7.1-critical-bug-fixes/7.1-02-SUMMARY.md`
</output>
