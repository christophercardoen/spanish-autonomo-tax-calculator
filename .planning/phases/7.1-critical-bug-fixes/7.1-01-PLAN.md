---
phase: 7.1-critical-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - autonomo_dashboard.html
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Add expense button opens the add expense form when clicked"
    - "All expense names display in English (no Dutch text)"
    - "Belgium cost toggle uses pill-style buttons instead of checkbox slider"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Fixed expense functionality with English text and pill toggle"
      contains: "Rent (30%)"
  key_links:
    - from: "add-expense-btn onclick"
      to: "showAddForm function"
      via: "onclick handler"
      pattern: "showAddForm"
---

<objective>
Fix add expense button, remove Dutch text, and redesign Belgium cost toggle

Purpose: Users cannot add expenses and the UI contains Dutch text despite being an English-language tool. The Belgium toggle uses outdated checkbox slider design.
Output: Working add expense functionality, all English text, modern pill-style Belgium toggle
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@autonomo_dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix add expense button and remove Dutch text</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Debug and fix the add expense button:
       - Verify showAddForm function is defined before onclick handlers execute
       - Ensure the form element (#addExpenseForm) exists in DOM at page load
       - Check if the form is in the correct tab panel and visible when opened
       - Add console.log debugging if needed to trace the issue
       - The button calls `onclick="showAddForm('${categoryKey}')"` - verify the function toggles the 'hidden' class correctly

    2. Replace all Dutch expense names with English:
       - In DEFAULT_EXPENSES constant:
         - 'Huur (Rent)' -> 'Rent (30% deductible)'
         - 'Elektriciteit' -> 'Electricity'
         - 'Huur 70%' -> 'Rent (70% private)'
         - 'GSM (Mobile)' remains (already has English)
         - 'GSM 50%' -> 'Mobile (50% private)'
         - 'Elektriciteit 91%' -> 'Electricity (91% private)'
         - 'Verzekeringen' -> 'Insurance'
       - Keep the expense IDs as-is (huur, gsm, elektriciteit, etc.) for backwards compatibility with localStorage

    3. Test that clicking "Add Expense" button shows the form:
       - Form should appear below the expense list
       - Category should be pre-selected based on which section's button was clicked
       - Submitting the form should create the expense and hide the form
  </action>
  <verify>
    - Open autonomo_dashboard.html in browser
    - Navigate to Expenses tab
    - Click "Add Expense" button in any section
    - Form should appear with category pre-selected
    - All expense names should display in English
  </verify>
  <done>
    - Add expense button opens form correctly
    - Form submission creates new expense
    - All DEFAULT_EXPENSES names are in English
    - No Dutch text visible in expense sections
  </done>
</task>

<task type="auto">
  <name>Task 2: Redesign Belgium cost toggle as pill buttons</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Replace checkbox-based toggle switch with pill-style button group:
       - Remove the `.toggle-switch` CSS with input/slider pattern
       - Create new `.pill-toggle` CSS class:
         ```css
         .pill-toggle {
           display: inline-flex;
           background: rgba(255,255,255,0.1);
           border-radius: 20px;
           padding: 4px;
           gap: 0;
         }
         .pill-toggle button {
           padding: 8px 16px;
           border: none;
           background: transparent;
           color: var(--text-muted);
           border-radius: 16px;
           cursor: pointer;
           font-size: 0.9rem;
           transition: all 0.2s;
         }
         .pill-toggle button.active {
           background: var(--accent);
           color: var(--bg);
           font-weight: 600;
         }
         .pill-toggle button:hover:not(.active) {
           color: var(--text);
         }
         ```

    2. Update renderExpenseSection() for belgiumCosts:
       - Replace the toggle-switch HTML with pill-toggle HTML:
         ```html
         <div class="pill-toggle" role="group" aria-label="Belgium cost pattern">
           <button type="button" class="${!isHigh ? 'active' : ''}" onclick="setBelgiumPattern('low')">Low (1K)</button>
           <button type="button" class="${isHigh ? 'active' : ''}" onclick="setBelgiumPattern('high')">High (2.5K)</button>
         </div>
         ```

    3. Create setBelgiumPattern(pattern) function:
       - Set expenseData.belgiumPattern to 'low' or 'high'
       - Call updateBelgiumCost() to update the expense amount
       - Call saveExpenses() to persist
       - Call renderAllSections() to update UI
       - Call recalculateTotals() to update calculations

    4. Remove or comment out old toggle-related functions:
       - initBelgiumToggle() - no longer needed
       - updateToggleLabels() - no longer needed
       - Remove the call to initBelgiumToggle() in renderAllSections()

    5. Remove old CSS:
       - .toggle-switch
       - .toggle-switch input
       - .toggle-switch .slider
       - .toggle-switch .slider::before
       - .toggle-switch input:checked + .slider
       - .toggle-switch input:checked + .slider::before
       - .toggle-switch input:focus + .slider
       - .toggle-label
       - .toggle-label.active
  </action>
  <verify>
    - Open autonomo_dashboard.html in browser
    - Navigate to Expenses tab
    - Belgium Work Costs section shows pill-style toggle
    - Clicking "Low (1K)" or "High (2.5K)" switches the active state
    - Expense amount updates to 1000 or 2500 accordingly
    - Choice persists after page reload
  </verify>
  <done>
    - Pill toggle displays with proper styling
    - Low button shows 1000 EUR when active
    - High button shows 2500 EUR when active
    - Active state clearly indicated with accent color
    - No checkbox/slider toggle remains in UI
  </done>
</task>

</tasks>

<verification>
1. Expense Functionality:
   - [ ] Add expense button works in Spain Deductible section
   - [ ] Add expense button works in Belgium Costs section
   - [ ] Add expense button works in Private section
   - [ ] Form submission creates expense
   - [ ] New expense appears in list immediately
   - [ ] IRPF recalculates after adding expense

2. English Text:
   - [ ] No Dutch words (Huur, Elektriciteit, Verzekeringen) visible
   - [ ] All expense labels in English
   - [ ] Percentage suffixes clear (30% deductible, 91% private, etc.)

3. Belgium Pill Toggle:
   - [ ] Pill toggle displays correctly
   - [ ] Low (1K) button works
   - [ ] High (2.5K) button works
   - [ ] Active state visible
   - [ ] Value persists after refresh
</verification>

<success_criteria>
- All three bug requirements (BUG-01, BUG-03, BUG-04) are resolved
- Add expense button opens form and creates expenses
- All text displays in English
- Belgium toggle uses pill-style buttons with clear active state
</success_criteria>

<output>
After completion, create `.planning/phases/7.1-critical-bug-fixes/7.1-01-SUMMARY.md`
</output>
