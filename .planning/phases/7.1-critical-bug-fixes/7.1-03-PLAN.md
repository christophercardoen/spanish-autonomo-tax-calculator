---
phase: 7.1-critical-bug-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - autonomo_dashboard.html
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Calendar supports selecting entire weeks with one click"
    - "Calendar supports selecting entire months with one click"
    - "Multi-select shows visual feedback for selected range"
    - "Bulk picker dialog shows for week and month selections"
  artifacts:
    - path: "autonomo_dashboard.html"
      provides: "Enhanced calendar multi-select with week and month selection"
      contains: "selectWeek"
  key_links:
    - from: "week header click"
      to: "selectWeek function"
      via: "onclick handler"
      pattern: "selectWeek"
    - from: "month header click"
      to: "selectMonth function"
      via: "onclick handler"
      pattern: "selectMonth"
---

<objective>
Enhance calendar multi-select with week and month selection

Purpose: Currently only shift-click range selection works. Users need faster ways to select entire weeks or months for bulk operations.
Output: Clickable week row headers and month headers that select all days in that unit
</objective>

<execution_context>
@/Users/christophercardoen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/christophercardoen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@autonomo_dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add week selection functionality</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Add CSS for week selector:
       ```css
       /* Week row selector */
       .week-selector {
         display: flex;
         align-items: center;
         justify-content: center;
         width: 28px;
         height: 28px;
         background: rgba(255,255,255,0.05);
         border-radius: 4px;
         cursor: pointer;
         color: var(--text-muted);
         font-size: 0.7rem;
         transition: all 0.2s;
       }

       .week-selector:hover {
         background: var(--accent);
         color: var(--bg);
       }

       .week-selector::before {
         content: 'W';
       }

       /* Calendar grid adjustment for week selector column */
       .calendar-grid {
         display: grid;
         grid-template-columns: 28px repeat(7, 1fr);  /* Add column for week selector */
         gap: 4px;
       }

       .calendar-header {
         /* First cell is empty (above week selectors) */
       }

       .calendar-header:first-child {
         visibility: hidden;
       }
       ```

    2. Update renderMonthCalendar() to include week selectors:
       - Add empty cell at start of header row (for week selector column alignment)
       - For each week row, add a week selector button at the start:
         ```javascript
         // At the start of each week row, add week selector
         const weekStartDate = firstDayOfWeek; // Calculate this for each row
         const weekEndDate = new Date(weekStartDate);
         weekEndDate.setDate(weekEndDate.getDate() + 6);

         html += `<div class="week-selector" onclick="selectWeek('${toISODateKey(weekStartDate)}')" title="Select this week"></div>`;
         ```

    3. Create selectWeek(weekStartDateKey) function:
       ```javascript
       /**
        * Select all days in a week
        * @param {string} weekStartDateKey - ISO date key of week start (Monday)
        */
       function selectWeek(weekStartDateKey) {
         const startDate = new Date(weekStartDateKey);
         selectedDates.clear();

         // Add all 7 days of the week
         for (let i = 0; i < 7; i++) {
           const day = new Date(startDate);
           day.setDate(startDate.getDate() + i);

           // Only include if in valid range (Feb-Dec 2026)
           const month = day.getMonth();
           if (day.getFullYear() === 2026 && month >= 1 && month <= 11) {
             selectedDates.add(toISODateKey(day));
           }
         }

         // Re-render and open bulk picker
         renderCalendar();
         updateCountDisplays();
         if (selectedDates.size > 0) {
           openBulkPicker();
         }
       }
       ```

    4. Add visual feedback for selected days:
       ```css
       /* Selected day highlight */
       .day-cell.selected {
         outline: 2px solid var(--accent);
         outline-offset: -2px;
       }
       ```

    5. Update renderMonthCalendar() to add 'selected' class to selected days:
       ```javascript
       const isSelected = selectedDates.has(dateKey);
       const cellClasses = ['day-cell', statusClass];
       if (isSelected) cellClasses.push('selected');
       if (dayData.contracted) cellClasses.push('contracted');
       ```
  </action>
  <verify>
    - Open autonomo_dashboard.html in browser
    - Navigate to Calendar tab
    - Each week row should have a "W" button on the left
    - Clicking "W" selects all days in that week
    - Selected days show visual highlight (outline)
    - Bulk picker dialog opens with correct count
  </verify>
  <done>
    - Week selector buttons appear on each calendar row
    - selectWeek function selects all 7 days (within valid range)
    - Selected days have visible highlight
    - Bulk picker opens after week selection
  </done>
</task>

<task type="auto">
  <name>Task 2: Add month selection functionality</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Add CSS for month selector:
       ```css
       /* Month selector in header */
       .month-selector {
         display: inline-flex;
         align-items: center;
         gap: 0.5rem;
         padding: 0.25rem 0.75rem;
         background: rgba(255,255,255,0.1);
         border: none;
         border-radius: 4px;
         color: var(--text);
         cursor: pointer;
         font-size: 0.85rem;
         transition: all 0.2s;
         margin-left: 1rem;
       }

       .month-selector:hover {
         background: var(--accent);
         color: var(--bg);
       }

       .month-selector::before {
         content: 'Select all';
       }
       ```

    2. Update the calendar month header to include month selector button:
       - Find where the month name is rendered (e.g., "February 2026")
       - Add a "Select all" button next to the month name:
         ```javascript
         html += `
           <div class="calendar-month-header">
             <span class="month-name">${monthNames[month]} ${year}</span>
             <button type="button" class="month-selector" onclick="selectMonth(${month})"></button>
           </div>
         `;
         ```

    3. Create selectMonth(month) function:
       ```javascript
       /**
        * Select all days in a month
        * @param {number} month - Month index (0-11)
        */
       function selectMonth(month) {
         selectedDates.clear();

         // Get first and last day of month
         const year = 2026;
         const firstDay = new Date(year, month, 1);
         const lastDay = new Date(year, month + 1, 0);

         // Add all days in the month
         const current = new Date(firstDay);
         while (current <= lastDay) {
           selectedDates.add(toISODateKey(current));
           current.setDate(current.getDate() + 1);
         }

         // Re-render and open bulk picker
         renderCalendar();
         updateCountDisplays();
         openBulkPicker();
       }
       ```

    4. Update bulk picker dialog count message:
       ```javascript
       // In openBulkPicker()
       const count = selectedDates.size;
       const countText = count === 1 ? '1 day' : `${count} days`;
       document.getElementById('bulkCount').textContent = countText;
       ```

    5. Update bulk picker dialog HTML if needed:
       - Ensure the dialog text makes sense for large selections
       - E.g., "Set status for 28 days" instead of just "28"
  </action>
  <verify>
    - Calendar month header shows "Select all" button
    - Clicking "Select all" highlights all days in that month
    - Bulk picker shows correct count (e.g., "28 days", "31 days")
    - Applying status updates all selected days
  </verify>
  <done>
    - Month selector button in calendar header
    - selectMonth function selects all days in month
    - Bulk picker shows "X days" format
    - All days in month get updated status
  </done>
</task>

<task type="auto">
  <name>Task 3: Improve multi-select visual feedback</name>
  <files>autonomo_dashboard.html</files>
  <action>
    1. Add selection count indicator in calendar UI:
       ```html
       <div id="selectionIndicator" class="selection-indicator hidden">
         <span id="selectionCount">0</span> days selected
         <button type="button" class="clear-selection" onclick="clearSelection()">Clear</button>
       </div>
       ```

    2. Add CSS for selection indicator:
       ```css
       .selection-indicator {
         display: flex;
         align-items: center;
         gap: 0.75rem;
         padding: 0.5rem 1rem;
         background: var(--accent);
         color: var(--bg);
         border-radius: 8px;
         font-size: 0.9rem;
         font-weight: 500;
         margin-bottom: 1rem;
       }

       .selection-indicator.hidden {
         display: none;
       }

       .clear-selection {
         padding: 0.25rem 0.5rem;
         background: rgba(0,0,0,0.2);
         border: none;
         border-radius: 4px;
         color: inherit;
         cursor: pointer;
         font-size: 0.8rem;
       }

       .clear-selection:hover {
         background: rgba(0,0,0,0.3);
       }
       ```

    3. Create clearSelection() function:
       ```javascript
       /**
        * Clear all selected dates and hide indicator
        */
       function clearSelection() {
         selectedDates.clear();
         renderCalendar();
         updateSelectionIndicator();
       }
       ```

    4. Create updateSelectionIndicator() function:
       ```javascript
       /**
        * Update selection indicator visibility and count
        */
       function updateSelectionIndicator() {
         const indicator = document.getElementById('selectionIndicator');
         const countEl = document.getElementById('selectionCount');

         if (!indicator || !countEl) return;

         if (selectedDates.size > 0) {
           countEl.textContent = selectedDates.size;
           indicator.classList.remove('hidden');
         } else {
           indicator.classList.add('hidden');
         }
       }
       ```

    5. Call updateSelectionIndicator() after any selection change:
       - In selectWeek()
       - In selectMonth()
       - In selectDateRange()
       - In closeBulkPicker() (when selection cleared)
       - In saveBulkStatus() (when selection cleared)

    6. Add the selection indicator HTML to calendar panel:
       - Add it after the month navigation and before the calendar grid
  </action>
  <verify>
    - Selecting days shows indicator bar: "X days selected [Clear]"
    - Clear button removes selection
    - Indicator hides when no selection
    - Indicator updates for week/month/range selection
  </verify>
  <done>
    - Selection indicator displays when days are selected
    - Count updates correctly for all selection methods
    - Clear button clears selection and hides indicator
    - Consistent visual feedback across all multi-select operations
  </done>
</task>

</tasks>

<verification>
1. Week Selection:
   - [ ] Week selector (W) buttons visible on each row
   - [ ] Clicking W selects all days in week
   - [ ] Works correctly for partial weeks (start/end of month)
   - [ ] Bulk picker opens with correct count

2. Month Selection:
   - [ ] "Select all" button in month header
   - [ ] Clicking selects all days in month
   - [ ] Bulk picker shows "X days" format
   - [ ] Works for all months (Feb-Dec)

3. Visual Feedback:
   - [ ] Selected days have outline highlight
   - [ ] Selection indicator bar shows count
   - [ ] Clear button works
   - [ ] Indicator hides when no selection

4. Integration:
   - [ ] Shift-click range selection still works
   - [ ] Single-click still opens day picker
   - [ ] All selection methods work with bulk picker
   - [ ] Status changes apply to all selected days
</verification>

<success_criteria>
- BUG-05 is resolved: calendar supports week and month selection
- Week selection via "W" buttons on each row
- Month selection via "Select all" button in header
- Clear visual feedback for selected days
- Selection indicator shows count with clear option
</success_criteria>

<output>
After completion, create `.planning/phases/7.1-critical-bug-fixes/7.1-03-SUMMARY.md`
</output>
